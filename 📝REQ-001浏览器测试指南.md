# 📝 REQ-001 浏览器测试指南

## 🎯 快速验证（30秒）

### 步骤1: 打开Dashboard
```
http://127.0.0.1:8877
```

### 步骤2: 找到"清除缓存"按钮

**位置**: 页面顶部"项目信息"区域，"缓存版本"那一行

**应该看到**:
```
缓存版本: v20251118210552  [🔄 清除缓存]
                            ↑ 这个按钮
```

### 步骤3: 点击按钮测试

1. 点击 **"🔄 清除缓存"**
2. 会弹出确认对话框 ✅
3. 点击"确定"
4. 会显示 **"✅ 缓存已清除"** 提示 ✅
5. 2秒后页面自动刷新 ✅
6. 版本号会变化（如 v20251118210552 → v20251118210653）✅

---

## 🔍 完整测试（5分钟）

### 测试1: 检查Console日志

**操作**: 按 `F12` → 切换到 **Console** 标签

**应该看到的日志**:
```
[缓存管理] 当前缓存版本: v20251118210552
[缓存管理] Service Worker注册成功: http://127.0.0.1:8877/
```

✅ 如果看到这些日志 = Service Worker正常工作

❌ 如果看到错误 = 需要检查

---

### 测试2: 检查Service Worker状态

**操作**: 
1. 按 `F12` 打开开发者工具
2. 切换到 **Application** 标签
3. 左侧菜单 → **Service Workers**

**应该看到**:
```
Source: /static/sw.js
Status: ⬤ activated and is running
```

✅ 绿点 + "activated" = 正常
❌ 红点或错误 = 有问题

---

### 测试3: 测试缓存清除功能

**完整流程**:

1. **记录当前版本号**
   - 查看页面上的"缓存版本"
   - 例如: `v20251118210552`

2. **点击清除缓存按钮**
   - 点击 🔄 按钮
   - 确认对话框

3. **观察提示信息**
   - 应该显示: "✅ 缓存已清除"
   - 新版本: v20251118210653
   - 页面将在 2 秒后刷新...

4. **页面自动刷新**
   - 等待2秒
   - 页面自动刷新 ✅

5. **验证版本号变化**
   - 刷新后版本号应该更新
   - `v20251118210552` → `v20251118210653` ✅

---

### 测试4: 验证不需要换端口

**场景**: 修改代码后刷新页面

**步骤**:
1. 修改任意Dashboard代码（如改个文字）
2. 保存文件
3. 浏览器按 `F5` 刷新
4. ✅ 应该看到最新内容（不需要换端口！）

**旧方式对比**:
- ❌ 旧: 修改 → 换端口(8870→8871) → 重启 → 打开新端口
- ✅ 新: 修改 → F5刷新 → 完成

---

## 📊 测试检查清单

### 基础功能

- [ ] 页面能正常打开 (http://127.0.0.1:8877)
- [ ] 能看到"缓存版本"显示
- [ ] 能看到"🔄 清除缓存"按钮
- [ ] 按钮可以点击
- [ ] 点击后弹出确认对话框

### 高级功能

- [ ] Console显示Service Worker注册成功
- [ ] Application标签显示SW已激活
- [ ] 清除缓存后版本号更新
- [ ] 清除缓存后页面自动刷新
- [ ] 修改代码后F5刷新能看到最新内容

### 错误检查

- [ ] Console无红色错误
- [ ] Network标签无404错误
- [ ] Service Worker无注册失败

---

## 🐛 常见问题

### Q1: 点击按钮没反应？

**检查**:
1. 打开Console，看是否有JavaScript错误
2. 检查API是否正常: `curl http://127.0.0.1:8877/api/cache/version`
3. 如果返回404，说明服务器未重启

**解决**:
```bash
# 停止旧进程
taskkill /F /IM python.exe /FI "WINDOWTITLE eq *start_dashboard*"

# 重新启动
cd taskflow-v1.7-monorepo/apps/dashboard
python start_dashboard.py
```

---

### Q2: Service Worker注册失败？

**Console错误**:
```
Failed to register a ServiceWorker: A bad HTTP response code (404) was received
```

**原因**: /static/sw.js 返回404

**检查**:
```bash
curl -I http://127.0.0.1:8877/static/sw.js
# 应该返回: HTTP/1.1 200 OK
```

**解决**: 确认已修复路径配置并重启服务器

---

### Q3: 版本号不更新？

**原因**: 浏览器强缓存

**解决**:
1. 按 `Ctrl+Shift+R` 强制刷新
2. 或在开发者工具中勾选 "Disable cache"

---

### Q4: 修改代码后刷新还是旧内容？

**可能原因**:
1. 浏览器缓存
2. Service Worker缓存

**解决方案**:
1. 点击"清除缓存"按钮（推荐）
2. 或 F12 → Application → Clear storage → Clear site data

---

## ✅ 验收标准

全部测试通过的标准：

✅ **基础功能**（必需）
- 页面正常加载
- 按钮可见可点击
- 清除功能正常工作

✅ **高级功能**（推荐）
- Service Worker正常注册
- 版本号自动更新
- 不需要换端口

✅ **无错误**（必需）
- Console无红色错误
- Network无404
- Service Worker正常

---

## 🎉 测试通过标志

当你看到以下情况，说明功能完全正常：

1. ✅ 点击"清除缓存"按钮
2. ✅ 弹出确认对话框
3. ✅ 显示"✅ 缓存已清除"
4. ✅ 页面自动刷新
5. ✅ 版本号更新
6. ✅ Console无错误

**恭喜！REQ-001功能完全可用！** 🎊

---

## 📞 需要帮助？

如果测试中遇到问题：

1. 查看 **✅TASK-FIX-001-002-修复完成报告.md**
2. 查看 **✅TASK-VERIFY-001-验证报告.md**
3. 检查Dashboard启动日志
4. 检查浏览器Console错误

---

**最后更新**: 2025-11-18 21:07  
**状态**: ✅ 修复完成，可以测试

