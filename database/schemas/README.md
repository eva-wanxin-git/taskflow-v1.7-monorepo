# ä»»åŠ¡æ‰€Â·Flow v1.7 - Database Schemas

## ğŸ“š Schemaæ–‡ä»¶è¯´æ˜

### v1_tasks_schema.sql
**ç‰ˆæœ¬**: v1.0-v1.6ç»§æ‰¿  
**å†…å®¹**: ä»»åŠ¡ç®¡ç†æ ¸å¿ƒè¡¨ï¼ˆ3ä¸ªï¼‰
- tasks - ä»»åŠ¡ä¸»è¡¨
- task_dependencies - ä»»åŠ¡ä¾èµ–å…³ç³»
- task_completions - ä»»åŠ¡å®Œæˆè¯¦æƒ…

### v2_knowledge_schema.sql
**ç‰ˆæœ¬**: v1.7æ–°å¢  
**å†…å®¹**: é¡¹ç›®çŸ¥è¯†åº“è¡¨ï¼ˆ9ä¸ªï¼‰
- projects - é¡¹ç›®ä¸»è¡¨
- components - ç»„ä»¶/æ¨¡å—è¡¨
- issues - é—®é¢˜è®°å½•è¡¨
- solutions - è§£å†³æ–¹æ¡ˆè¡¨
- decisions - æŠ€æœ¯å†³ç­–è¡¨ï¼ˆADRï¼‰
- knowledge_articles - çŸ¥è¯†æ–‡ç« è¡¨
- tools - å·¥å…·è¡¨
- component_tools - ç»„ä»¶å·¥å…·å…³è”è¡¨
- deployments - éƒ¨ç½²è®°å½•è¡¨

### v3_events_schema.sql
**ç‰ˆæœ¬**: v1.7æ–°å¢  
**å†…å®¹**: äº‹ä»¶ç³»ç»Ÿè¡¨ï¼ˆ3ä¸ªï¼‰
- project_events - é¡¹ç›®äº‹ä»¶ä¸»è¡¨
- event_types - äº‹ä»¶ç±»å‹å®šä¹‰è¡¨
- event_stats - äº‹ä»¶ç»Ÿè®¡è¡¨

### v4_enterprise_knowledge_schema.sql
**ç‰ˆæœ¬**: v1.7æ–°å¢ï¼ˆä¼ä¸šçº§æ‰©å±•ï¼‰  
**å†…å®¹**: ä¼ä¸šçº§è¡¨ + è®°å¿†ç³»ç»Ÿè¡¨ï¼ˆ4ä¸ªæ–°è¡¨ + 4ä¸ªæ‰©å±•è¡¨ï¼‰

#### æ–°å¢è¡¨ï¼ˆ4ä¸ªï¼‰
1. **environments** - ç¯å¢ƒç®¡ç†è¡¨
   - æ”¯æŒdev/staging/productionå¤šç¯å¢ƒ
   - èµ„æºé…ç½®ã€ç¯å¢ƒå˜é‡åŠ å¯†å­˜å‚¨
   - ç”Ÿäº§ç¯å¢ƒå®¡æ‰¹æœºåˆ¶

2. **interaction_events** - AIäº¤äº’äº‹ä»¶è¡¨
   - è®°å½•ç”¨æˆ·â†”AIæ¯æ¬¡äº¤äº’
   - Tokenä½¿ç”¨ç»Ÿè®¡ï¼ˆinput/output/totalï¼‰
   - æ”¯æŒå¤šAIè§’è‰²ï¼ˆarchitect/fullstack/code-steward/sreï¼‰

3. **memory_snapshots** - è®°å¿†å¿«ç…§è¡¨
   - AIè®°å¿†æç‚¼å’ŒçŸ¥è¯†æ²‰æ·€
   - 4ç§å¿«ç…§ç±»å‹ï¼ˆsession_end/milestone/handover/periodicï¼‰
   - ç½®ä¿¡åº¦è¯„åˆ†ã€21åº“åˆ†ç±»æ˜ å°„

4. **memory_categories** - 21åº“çŸ¥è¯†åˆ†ç±»è¡¨
   - ä¸‰å±‚åˆ†ç±»ä½“ç³»ï¼ˆåŸºç¡€è®¾æ–½/ä¸šåŠ¡é€»è¾‘/åº”ç”¨å±‚ï¼‰
   - 21ä¸ªé¢„å®šä¹‰åˆ†ç±»ï¼ˆæ¯å±‚7ä¸ªï¼‰
   - å·²åˆå§‹åŒ–æ•°æ®

#### æ‰©å±•è¡¨ï¼ˆ4ä¸ªï¼‰
1. **toolsè¡¨æ‰©å±•**
   - category - ç»†åˆ†ç±»åˆ«
   - installation - å®‰è£…æ–¹å¼ï¼ˆJSONï¼‰
   - license - è®¸å¯è¯
   - website_url - å®˜ç½‘åœ°å€
   - is_active - æ˜¯å¦åœ¨ç”¨

2. **component_toolsè¡¨æ‰©å±•**
   - version_used - ä½¿ç”¨çš„ç‰ˆæœ¬
   - importance - é‡è¦æ€§çº§åˆ«
   - notes - å¤‡æ³¨è¯´æ˜
   - configuration - é…ç½®ä¿¡æ¯ï¼ˆJSONï¼‰

3. **knowledge_articlesè¡¨æ‰©å±•**
   - layer - çŸ¥è¯†å±‚çº§ï¼ˆ1/2/3ï¼‰
   - category_code - 21åº“åˆ†ç±»ä»£ç 
   - version - æ–‡ç« ç‰ˆæœ¬
   - importance - é‡è¦æ€§çº§åˆ«
   - author - ä½œè€…
   - view_count - æŸ¥çœ‹æ¬¡æ•°

4. **deploymentsè¡¨æ‰©å±•**
   - environment_id - ç¯å¢ƒID
   - build_number - æ„å»ºå·
   - commit_hash - Gitæäº¤å“ˆå¸Œ
   - duration_seconds - éƒ¨ç½²è€—æ—¶
   - deployment_type - éƒ¨ç½²ç±»å‹
   - approved_by - å®¡æ‰¹è€…

---

## ğŸ“Š 21åº“çŸ¥è¯†åˆ†ç±»ä½“ç³»

### ç¬¬1å±‚ï¼šåŸºç¡€è®¾æ–½å±‚ï¼ˆ7ä¸ªï¼‰
| ä»£ç  | åç§° | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|------|
| KB-01 | åŸºç¡€è®¾æ–½ | ğŸ—ï¸ | æœåŠ¡å™¨ã€ç½‘ç»œã€å­˜å‚¨ç­‰åŸºç¡€è®¾æ–½çŸ¥è¯† |
| KB-02 | æ•°æ®åº“ | ğŸ—„ï¸ | æ•°æ®åº“è®¾è®¡ã€ä¼˜åŒ–ã€ç®¡ç†çŸ¥è¯† |
| KB-03 | DevOps | ğŸš€ | CI/CDã€å®¹å™¨åŒ–ã€è‡ªåŠ¨åŒ–éƒ¨ç½²çŸ¥è¯† |
| KB-04 | å®‰å…¨ | ğŸ”’ | å®‰å…¨ç­–ç•¥ã€åŠ å¯†ã€è®¤è¯æˆæƒçŸ¥è¯† |
| KB-05 | ç›‘æ§ | ğŸ“Š | æ—¥å¿—ã€ç›‘æ§ã€å‘Šè­¦ã€æ€§èƒ½åˆ†æçŸ¥è¯† |
| KB-06 | ç½‘ç»œ | ğŸŒ | ç½‘ç»œåè®®ã€è´Ÿè½½å‡è¡¡ã€CDNçŸ¥è¯† |
| KB-07 | å·¥å…·é“¾ | ğŸ”§ | å¼€å‘å·¥å…·ã€æ¡†æ¶ã€åº“çš„ä½¿ç”¨çŸ¥è¯† |

### ç¬¬2å±‚ï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼ˆ7ä¸ªï¼‰
| ä»£ç  | åç§° | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|------|
| KB-08 | é¢†åŸŸæ¨¡å‹ | ğŸ›ï¸ | ä¸šåŠ¡é¢†åŸŸå»ºæ¨¡ã€DDDçŸ¥è¯† |
| KB-09 | ç®—æ³• | ğŸ§® | ç®—æ³•è®¾è®¡ã€æ•°æ®ç»“æ„ã€ä¼˜åŒ–ç­–ç•¥ |
| KB-10 | APIè®¾è®¡ | ğŸ”Œ | RESTfulã€GraphQLã€æ¥å£è®¾è®¡ |
| KB-11 | è®¾è®¡æ¨¡å¼ | ğŸ¨ | è½¯ä»¶è®¾è®¡æ¨¡å¼ã€æ¶æ„æ¨¡å¼ |
| KB-12 | ä¸šåŠ¡è§„åˆ™ | ğŸ“‹ | ä¸šåŠ¡æµç¨‹ã€è§„åˆ™å¼•æ“ |
| KB-13 | ç³»ç»Ÿé›†æˆ | ğŸ”— | ç¬¬ä¸‰æ–¹é›†æˆã€æ¶ˆæ¯é˜Ÿåˆ— |
| KB-14 | æµ‹è¯• | âœ… | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€è‡ªåŠ¨åŒ–æµ‹è¯• |

### ç¬¬3å±‚ï¼šåº”ç”¨å±‚ï¼ˆ7ä¸ªï¼‰
| ä»£ç  | åç§° | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|------|
| KB-15 | UI/UX | ğŸ¨ | ç”¨æˆ·ç•Œé¢è®¾è®¡ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ– |
| KB-16 | å‰ç«¯ | ğŸ’» | å‰ç«¯æ¡†æ¶ã€ç»„ä»¶ã€çŠ¶æ€ç®¡ç† |
| KB-17 | ç§»åŠ¨ç«¯ | ğŸ“± | iOSã€Androidã€è·¨å¹³å°å¼€å‘ |
| KB-18 | æ€§èƒ½ä¼˜åŒ– | âš¡ | å‰ç«¯æ€§èƒ½ã€åç«¯ä¼˜åŒ– |
| KB-19 | å¯è®¿é—®æ€§ | â™¿ | æ— éšœç¢è®¾è®¡ã€å›½é™…åŒ– |
| KB-20 | æ–‡æ¡£ | ğŸ“š | æŠ€æœ¯æ–‡æ¡£ã€APIæ–‡æ¡£ã€ç”¨æˆ·æ‰‹å†Œ |
| KB-21 | æœ€ä½³å®è·µ | â­ | ç¼–ç è§„èŒƒã€å›¢é˜Ÿåä½œã€é¡¹ç›®ç®¡ç† |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. æŸ¥çœ‹Schema
```bash
# æŸ¥çœ‹v4ä¼ä¸šçº§Schema
cat database/schemas/v4_enterprise_knowledge_schema.sql
```

### 2. æ‰§è¡Œè¿ç§»
```bash
# ä¾æ¬¡æ‰§è¡Œè¿ç§»
python database/migrations/migrate.py apply 001  # v1 tasks
python database/migrations/migrate.py apply 002  # v2 knowledge
python database/migrations/migrate.py apply 004  # v3 events
python database/migrations/migrate.py apply 005  # v4 enterprise
```

### 3. æµ‹è¯•Schema
```bash
# æµ‹è¯•ä¼ä¸šçº§Schema
python database/migrations/test_enterprise_schema.py
```

### 4. æŸ¥è¯¢21åº“åˆ†ç±»
```sql
-- æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»
SELECT code, display_name, layer FROM memory_categories ORDER BY sort_order;

-- æŒ‰å±‚çº§ç»Ÿè®¡
SELECT layer, COUNT(*) as count FROM memory_categories GROUP BY layer;
```

---

## ğŸ“ˆ ç»Ÿè®¡æ•°æ®

| ç‰ˆæœ¬ | è¡¨æ•°é‡ | ç´¢å¼•æ•°é‡ | è¡Œæ•° | è¯´æ˜ |
|------|--------|----------|------|------|
| v1 | 3 | 4 | ~60 | ä»»åŠ¡ç®¡ç†æ ¸å¿ƒ |
| v2 | 9 | 11 | ~170 | çŸ¥è¯†åº“åŸºç¡€ |
| v3 | 3 | 6 | ~135 | äº‹ä»¶ç³»ç»Ÿ |
| v4 | 4+4æ‰©å±• | 25 | ~458 | ä¼ä¸šçº§æ‰©å±• |
| **æ€»è®¡** | **19** | **46** | **~823** | **å®Œæ•´ç³»ç»Ÿ** |

---

## âš™ï¸ æŠ€æœ¯è¦æ±‚

- **æ•°æ®åº“**: SQLite 3.38+ï¼ˆæ”¯æŒJSONå‡½æ•°ï¼‰
- **Python**: 3.9+
- **å¤–é”®çº¦æŸ**: éœ€æ‰‹åŠ¨å¯ç”¨ï¼ˆ`PRAGMA foreign_keys = ON`ï¼‰

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

1. **å®ŒæˆæŠ¥å‘Š**: `âœ…TASK-004-A2-å®ŒæˆæŠ¥å‘Š.md`
2. **è¿ç§»è„šæœ¬**: `database/migrations/005_enterprise_knowledge_schema.sql`
3. **æµ‹è¯•è„šæœ¬**: `database/migrations/test_enterprise_schema.py`

---

**æœ€åæ›´æ–°**: 2025-11-18  
**ç»´æŠ¤è€…**: AIå…¨æ ˆå·¥ç¨‹å¸ˆ

