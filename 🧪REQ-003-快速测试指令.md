# 🧪 REQ-003 对话历史库功能 - 快速测试指令

**测试目的**: 验证对话历史库功能是否正常工作  
**预计时间**: 5分钟  
**测试日期**: 2025-11-18

---

## ⚡ 一键测试

### 步骤1: 启动Dashboard
```bash
cd taskflow-v1.7-monorepo/apps/dashboard
python start_dashboard.py
```

**预期结果**:
```
======================================================================
任务所·Flow v1.7
======================================================================

[URL] http://127.0.0.1:8877
[Design] Luxury Industrial Aesthetics
[Features] Version Support | Task Management

Press Ctrl+C to stop
======================================================================
```

### 步骤2: 打开浏览器
浏览器会自动打开，或手动访问：`http://localhost:8877`

### 步骤3: 导航到对话历史库
1. 找到"架构师监控"模块（ARCHITECT MONITOR）
2. 点击"对话历史库"Tab（第2个Tab）

**预期结果**:
- ✅ Tab标题显示"对话历史库"（不是"对话交流"）
- ✅ 左侧显示"对话会话列表"和"共 3 个会话"
- ✅ 显示搜索框
- ✅ 显示3个会话卡片

### 步骤4: 验证会话列表
检查每个会话卡片是否包含：
- ✅ 会话标题
- ✅ 状态徽章（DONE或ACTIVE）
- ✅ Token统计（格式：8,500T）
- ✅ 时间标注（格式：11-18）
- ✅ 标签（最多3个）

### 步骤5: 点击查看详情
点击第一个会话"Dashboard数据更新需求讨论"

**预期结果**:
- ✅ 会话卡片变为黑色（active状态）
- ✅ 右侧显示会话详情
- ✅ 显示会话标题"Dashboard数据更新需求讨论"
- ✅ 显示元数据行（时间、持续、消息数、Token、参与者）
- ✅ 显示会话摘要（黄色背景）
- ✅ 显示6条消息
- ✅ 用户消息为蓝色背景，架构师消息为黄色背景
- ✅ 每条消息显示Token消耗

### 步骤6: 测试搜索功能
在搜索框输入"Dashboard"

**预期结果**:
- ✅ 会话列表立即过滤
- ✅ 只显示1个会话（包含"Dashboard"关键词的会话）
- ✅ 其他会话被隐藏

清空搜索框，输入"架构审查"

**预期结果**:
- ✅ 显示包含"架构审查"的会话
- ✅ 搜索匹配标题、标签、摘要

清空搜索框

**预期结果**:
- ✅ 所有3个会话重新显示

### 步骤7: 切换会话
点击第二个会话"架构审查与任务拆解"

**预期结果**:
- ✅ 第一个会话变为白色背景
- ✅ 第二个会话变为黑色背景
- ✅ 右侧显示新会话的详情
- ✅ Token显示为"45,000"（带千分位）
- ✅ 消息数显示为"15"

---

## 🔌 API测试（可选）

### 测试1: 获取所有会话
```bash
curl http://localhost:8877/api/conversations
```

**预期返回**:
```json
{
  "sessions": [
    {
      "session_id": "session-001",
      "title": "Dashboard数据更新需求讨论",
      ...
    },
    ...
  ]
}
```

### 测试2: 获取单个会话
```bash
curl http://localhost:8877/api/conversations/session-001
```

**预期返回**:
```json
{
  "session_id": "session-001",
  "title": "Dashboard数据更新需求讨论",
  "total_tokens": 8500,
  "messages_count": 6,
  ...
}
```

### 测试3: 创建新会话
```bash
curl -X POST http://localhost:8877/api/conversations \
  -H "Content-Type: application/json" \
  -d '{
    "title": "测试会话",
    "tags": ["测试", "开发"],
    "summary": "这是一个测试会话"
  }'
```

**预期返回**:
```json
{
  "success": true,
  "session": {
    "session_id": "session-004",
    "title": "测试会话",
    ...
  }
}
```

刷新浏览器，应该看到新会话出现在列表顶部，显示"共 4 个会话"。

### 测试4: 添加消息
```bash
curl -X POST http://localhost:8877/api/conversations/session-004/messages \
  -H "Content-Type: application/json" \
  -d '{
    "from": "用户",
    "content": "这是一条测试消息",
    "type": "request",
    "tokens": 500
  }'
```

**预期返回**:
```json
{
  "success": true,
  "message": {
    "id": "msg-001",
    "content": "这是一条测试消息",
    ...
  }
}
```

---

## ✅ 测试检查清单

### 基础功能
- [ ] Dashboard成功启动
- [ ] 浏览器自动打开
- [ ] 找到"对话历史库"Tab
- [ ] 会话列表正确显示
- [ ] 会话数量正确（3个）

### 会话列表
- [ ] 会话标题显示正确
- [ ] 状态徽章显示正确（DONE/ACTIVE）
- [ ] Token统计格式正确（千分位）
- [ ] 时间标注格式正确（月-日）
- [ ] 标签显示正确（最多3个）

### 会话详情
- [ ] 点击会话可查看详情
- [ ] Active状态正确切换
- [ ] 会话元数据完整
- [ ] 会话摘要显示正确
- [ ] 消息列表完整显示
- [ ] 用户/AI消息配色区分
- [ ] Token统计正确

### 搜索功能
- [ ] 搜索框可输入
- [ ] 即时过滤生效
- [ ] 搜索标题成功
- [ ] 搜索标签成功
- [ ] 搜索摘要成功
- [ ] 清空搜索恢复列表

### API功能（可选）
- [ ] GET /api/conversations 正常
- [ ] GET /api/conversations/{id} 正常
- [ ] POST /api/conversations 正常
- [ ] POST /api/conversations/{id}/messages 正常

---

## 🐛 常见问题

### Q1: 找不到"对话历史库"Tab
**原因**: 可能还在旧版本Dashboard  
**解决**: 
1. 确认端口是否正确（检查终端输出）
2. 强制刷新浏览器（Ctrl+F5）
3. 如果还不行，换新端口重启

### Q2: 会话列表显示"无法加载会话数据"
**原因**: architect-conversations.json不存在或格式错误  
**解决**: 
1. 确认文件存在：`apps/dashboard/automation-data/architect-conversations.json`
2. 检查JSON格式是否正确
3. 查看浏览器Console是否有错误

### Q3: 搜索功能不工作
**原因**: JavaScript错误  
**解决**: 
1. 打开浏览器开发者工具（F12）
2. 查看Console标签，看是否有错误
3. 如果有`filterSessions is not defined`错误，说明JS未正确加载

### Q4: API测试返回404
**原因**: Dashboard版本不对或端口错误  
**解决**: 
1. 确认使用正确的端口号
2. 确认Dashboard版本是v1.7
3. 检查dashboard.py是否包含新API端点

---

## 📊 测试结果模板

```markdown
## 测试结果

**测试人员**: [你的名字]  
**测试时间**: 2025-11-18  
**Dashboard端口**: 8877  
**浏览器**: Chrome 120

### 测试通过项 (通过/总计)
- 基础功能: 5/5 ✅
- 会话列表: 5/5 ✅
- 会话详情: 7/7 ✅
- 搜索功能: 6/6 ✅
- API功能: 4/4 ✅

### 总体评价
✅ 所有功能测试通过，可以投入使用

### 问题记录
无

### 建议
[可选] 未来可以添加XX功能
```

---

## 🎯 性能基准

### 数据量
- 会话数量: 3个
- 总消息数: 34条
- 总Token: 81,500

### 响应时间
- 页面加载: < 1秒
- Tab切换: < 100ms
- 会话切换: < 50ms
- 搜索过滤: < 10ms

### 浏览器兼容
- ✅ Chrome 120+
- ✅ Edge 120+
- ✅ Firefox 120+
- ⚠️ Safari（未测试）

---

**快速测试完成！如所有检查项通过，功能验收合格。** ✅

