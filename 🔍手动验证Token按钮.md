# 🔍 手动验证Token同步按钮

**目的**: 验证Dashboard上的Token同步按钮是否显示并可用  
**时间**: 5分钟  
**状态**: ⏳ 待验证

---

## 📋 验证清单

### 步骤1: 清除缓存（重要！）

**方法A: 换端口（最可靠）**
```bash
# 当前端口: 8877
# 切换到新端口: 8878

1. 关闭当前Dashboard（如果在运行）
2. 修改端口配置
3. 重新启动Dashboard
```

**方法B: 清除浏览器缓存**
```
1. Ctrl+Shift+Del
2. 选择"缓存的图片和文件"
3. 时间范围：全部
4. 点击"清除数据"
```

**方法C: 使用Dashboard清除按钮**
```
1. 打开 http://localhost:8877
2. 找到"清除缓存"按钮
3. 点击并确认
```

### 步骤2: 打开Dashboard

```
访问: http://localhost:8877
```

### 步骤3: 查找Token余量区域

**位置**: Dashboard页面中部偏上

**区域标识**:
```
◉ ARCHITECT MONITOR
工作中 | 已审查 X 个任务

▸ Token余量: XXX,XXX / 1,000,000 (XX.X%)
最后更新: --:--:--
```

### 步骤4: 查找同步按钮

**预期位置**: Token余量文本的右侧

**预期样式**:
```
[🔄 同步]  # 小蓝色按钮
```

### 步骤5: 点击测试

1. **点击"🔄 同步"按钮**
   - 预期：弹出对话框

2. **查看对话框内容**
   - 标题：🔄 同步Token使用量
   - 说明：请在Cursor中查看右下角状态栏的Token数字，复制后粘贴到下方
   - 输入框1：Token值
   - 输入框2：事件描述（可选）
   - 按钮：[取消] [✅ 同步]

3. **输入测试数据**
   ```
   Token值: 250000
   事件描述: 手动测试
   ```

4. **点击"✅ 同步"**
   - 预期：右上角显示成功通知
   - 预期：对话框自动关闭
   - 预期：Token余量更新为250,000

5. **验证更新**
   - Token余量应该变成: 250,000 / 1,000,000 (25.0%)
   - 百分比应该更新

---

## ✅ 验证结果

### 如果按钮存在并可用 ✅

**说明**: 功能已成功集成！

**记录结果**:
- [ ] Dashboard上有Token同步按钮 ✅
- [ ] 点击后弹出对话框 ✅
- [ ] 输入Token值后可以同步 ✅
- [ ] Token余量正确更新 ✅

**下一步**: 
1. 截图保存
2. 更新验证报告
3. 通知用户功能已上线

### 如果按钮不存在 ❌

**可能原因**:

1. **缓存问题**
   - 解决：清除浏览器缓存（Ctrl+Shift+Del）
   - 解决：换端口（8877 → 8878）
   - 解决：硬刷新（Ctrl+F5）

2. **JavaScript错误**
   - 解决：打开浏览器控制台（F12）
   - 查看：是否有红色错误信息
   - 记录：错误内容

3. **模板未更新**
   - 检查：templates.py是否包含showTokenSyncDialog
   - 检查：Dashboard是否重启
   - 检查：端口是否正确

**记录问题**:
```
问题描述: ________________________________
浏览器: ________________________________
错误信息: ________________________________
```

### 如果按钮存在但不可用 ⚠️

**测试**:
1. 点击按钮是否有反应
2. 浏览器控制台是否有错误
3. 网络请求是否发送成功

**记录问题**:
```
症状: ________________________________
错误: ________________________________
```

---

## 📸 截图要求

**需要截图的内容**:

1. **Dashboard整体**
   - 显示Token余量区域

2. **Token余量特写**
   - 清晰显示"🔄 同步"按钮

3. **点击后的对话框**
   - 显示完整的同步对话框

4. **同步成功通知**
   - 右上角的成功提示

5. **更新后的Token值**
   - 显示新的Token余量

**保存位置**: `docs/screenshots/token-sync/`

---

## 🐛 常见问题

### Q1: 看不到按钮？

A: 清除浏览器缓存！
```
Ctrl+Shift+Del → 清除全部 → 刷新页面
```

### Q2: 按钮点击无反应？

A: 打开浏览器控制台查看错误
```
F12 → Console → 查看红色错误
```

### Q3: Token值没有更新？

A: 检查网络请求
```
F12 → Network → 查找 record_token_usage 请求
查看返回值是否成功
```

### Q4: 显示乱码？

A: 浏览器编码问题，刷新页面即可

---

## 📝 验证报告模板

```markdown
# Token同步按钮验证结果

**验证时间**: 2025-11-18 22:40  
**验证者**: [你的名字]  
**浏览器**: Chrome/Firefox/Edge  

## 验证结果

- [ ] Token同步按钮存在
- [ ] 按钮可点击
- [ ] 对话框正常弹出
- [ ] Token同步功能正常
- [ ] Token值正确更新

## 截图

![Token余量区域](截图1.png)
![同步对话框](截图2.png)
![成功通知](截图3.png)

## 问题记录

[如果有问题，在此记录]

## 总体评价

功能状态: ✅ 正常 / ⚠️ 部分正常 / ❌ 异常
建议: [你的建议]
```

---

## 🚀 快速验证命令

**一键验证脚本**（5分钟内完成）:

```bash
# 1. 清除缓存
cd "C:\Users\Administrator\Desktop\cursor工作盘\taskflow-v1.7-monorepo"

# 2. 重启Dashboard（新端口）
# [手动操作: 关闭旧的Dashboard]

# 3. 启动新的Dashboard
python apps/dashboard/start_dashboard.py

# 4. 打开浏览器
start http://localhost:8877

# 5. 手动验证
# - 查找Token余量
# - 点击🔄按钮
# - 测试同步功能
```

---

**预计时间**: 5分钟  
**难度**: 简单  
**重要性**: 高（用户反馈"没感觉到功能"）

---

🔍 **开始验证吧！**

