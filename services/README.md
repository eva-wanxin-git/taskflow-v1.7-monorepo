# Services - 后台服务

## 📦 服务列表

### task_auto_monitor.py - 任务自动监控服务

**功能**: 实现任务状态的全自动化更新

**监控规则**:
1. 派发文档创建 → 记录派发事件
2. 派发文档打开15秒 → 自动更新为"进行中"
3. 完成报告创建 → 自动更新为"已完成"
4. 每30秒轮询 → 智能检测状态异常

**启动方式**:
```bash
# Windows
双击: 🚀启动自动监控服务.bat

# 或命令行
python services/task_auto_monitor.py
```

**依赖**:
```bash
pip install watchdog
```

---

## 🎯 使用场景

### 场景1: 架构师派发任务

```
1. 创建派发文档: 📤派发给李明-INTEGRATE-XXX.md
   ↓
   🤖 自动检测到，记录派发事件
   
2. 执行者打开派发文档
   ↓
   🤖 15秒后自动更新状态为"进行中"
   
3. 执行者完成，创建完成报告
   ↓
   🤖 自动检测到，更新状态为"已完成"
```

**完全无需人工运行脚本！**

---

### 场景2: 状态异常检测

```
每30秒检查:
- pending任务有完成报告 → 自动更新
- in_progress任务有完成报告 → 自动更新
- 任务超时 → 记录异常事件（未来实现）
```

---

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install watchdog
```

### 2. 启动服务
```bash
# Windows
🚀启动自动监控服务.bat

# Linux/Mac
python services/task_auto_monitor.py &
```

### 3. 验证运行
```
看到输出:
🟢 服务已启动
[INFO] 文件系统监控已启动 ✅
[INFO] 定时轮询已启动 ✅
```

---

## 📊 技术实现

### 文件监控
- 库: watchdog
- 事件: on_created, on_modified
- 范围: 整个项目目录

### 智能检测
- 完成报告存在 → 状态应该是completed
- 派发文档打开 → 可能在执行
- Git提交包含任务ID → 正在工作（未来）

### 事件记录
- 所有自动更新记录到event流
- 图标: 🤖（机器人，表示自动）
- 类型: auto_status_change

---

## 🎯 预期效果

### 升级前（半自动）
```
需要人工运行:
- python scripts/李明收到任务.py
- python scripts/李明提交完成.py

问题: 容易忘记
```

### 升级后（全自动）
```
完全自动:
- 打开派发文档 → 自动in_progress
- 创建完成报告 → 自动completed
- 无需人工干预 ✅
```

---

## ⚠️ 注意事项

### 1. 服务必须持续运行
```bash
# 确保服务在后台运行
# 可以加入启动脚本，开机自动启动
```

### 2. 文件命名规范
```
派发文档: 📤派发给*.md
完成报告: ✅*完成报告.md

必须遵守命名规范，否则无法自动检测
```

### 3. 数据库路径
```
确保数据库路径正确:
database/data/tasks.db
```

---

## 🚀 立即部署

**一键启动**: 双击 `🚀启动自动监控服务.bat`

**验证**: 创建一个测试派发文档，看是否自动检测

---

**全自动化服务已准备就绪！** 🎉

